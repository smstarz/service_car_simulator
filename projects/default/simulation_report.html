
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulation Report - default</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }
    
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 8px 8px 0 0;
    }
    
    .header h1 {
      font-size: 20px;
      margin-bottom: 8px;
    }
    
    .header .meta {
      font-size: 12px;
      opacity: 0.9;
      line-height: 1.4;
    }
    
    .tabs {
      display: flex;
      background: #f8f9fa;
      border-bottom: 2px solid #dee2e6;
    }
    
    .tab {
      padding: 12px 20px;
      cursor: pointer;
      background: transparent;
      border: none;
      font-size: 13px;
      font-weight: 500;
      color: #6c757d;
      transition: all 0.3s;
    }
    
    .tab:hover {
      background: #e9ecef;
    }
    
    .tab.active {
      color: #667eea;
      border-bottom: 3px solid #667eea;
      background: white;
    }
    
    .tab-content {
      padding: 20px;
    }
    
    .tab-pane {
      display: none;
    }
    
    .tab-pane.active {
      display: block;
    }
    
    .summary-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px;
      margin-bottom: 20px;
    }
    
    .card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .card:nth-child(2) {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }
    
    .card:nth-child(3) {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }
    
    .card:nth-child(4) {
      background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
    }
    
    .card-title {
      font-size: 11px;
      opacity: 0.9;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }
    
    .card-value {
      font-size: 22px;
      font-weight: bold;
    }
    
    .card-unit {
      font-size: 11px;
      opacity: 0.9;
      margin-left: 3px;
    }
    
    .chart-section {
      margin-bottom: 20px;
    }
    
    .chart-title {
      font-size: 12px;
      font-weight: 600;
      color: #333;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 2px solid #e9ecef;
    }
    
    .chart-container {
      position: relative;
      height: 250px;
      background: white;
      padding: 8px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      width: 100%;
    }
    
    .chart-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      width: 100%;
    }
    
    @media print {
      body {
        background: white;
      }
      
      .container {
        box-shadow: none;
      }
      
      .chart-container {
        page-break-inside: avoid;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>📊 Simulation Report</h1>
      <div class="meta">
        <div>Project: default</div>
        <div>Generated: 2025. 10. 22. 오후 1:17:03</div>
        <div>Simulation Period: 13:00 ~ 19:00</div>
      </div>
    </div>
    
    <div class="tabs">
      <button class="tab active" data-tab="vehicle">Vehicle Analysis</button>
      <button class="tab" data-tab="demand">Demand Analysis</button>
    </div>
    
    <div class="tab-content">
      <!-- Vehicle Tab -->
      <div id="vehicle-tab" class="tab-pane active">
        <div class="summary-cards">
          <div class="card">
            <div class="card-title">Total Vehicles</div>
            <div class="card-value">10<span class="card-unit">units</span></div>
          </div>
          <div class="card">
            <div class="card-title">Total Jobs</div>
            <div class="card-value">149<span class="card-unit">jobs</span></div>
          </div>
          <div class="card">
            <div class="card-title">Total Distance</div>
            <div class="card-value">232.82<span class="card-unit">km</span></div>
          </div>
          <div class="card">
            <div class="card-title">Total Moving Time</div>
            <div class="card-value">983.1<span class="card-unit">min</span></div>
          </div>
        </div>
        
        <div class="chart-section">
          <div class="chart-title">📈 Vehicle Performance Metrics</div>
          <div class="chart-grid">
            <div class="chart-container">
              <canvas id="chart-jobs"></canvas>
            </div>
            <div class="chart-container">
              <canvas id="chart-distance"></canvas>
            </div>
          </div>
          <div class="chart-grid">
            <div class="chart-container">
              <canvas id="chart-idle"></canvas>
            </div>
            <div class="chart-container">
              <canvas id="chart-utilization"></canvas>
            </div>
          </div>
          <div class="chart-grid">
            <div class="chart-container">
              <canvas id="chart-avg-distance"></canvas>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Demand Tab -->
      <div id="demand-tab" class="tab-pane">
        <div class="summary-cards">
          <div class="card">
            <div class="card-title">Total Demands</div>
            <div class="card-value"><span id="total-demands">0</span><span class="card-unit">demands</span></div>
          </div>
          <div class="card">
            <div class="card-title">Completed</div>
            <div class="card-value"><span id="completed-demands">0</span><span class="card-unit">demands</span></div>
          </div>
          <div class="card">
            <div class="card-title">Rejected</div>
            <div class="card-value"><span id="rejected-demands">0</span><span class="card-unit">demands</span></div>
          </div>
          <div class="card">
            <div class="card-title">Completion Rate</div>
            <div class="card-value"><span id="completion-rate">0</span><span class="card-unit">%</span></div>
          </div>
        </div>
        
        <div class="chart-section">
          <div class="chart-title">📈 Demand Analysis</div>
          <div class="chart-grid">
            <div class="chart-container">
              <canvas id="chart-demand-distance"></canvas>
            </div>
            <div class="chart-container">
              <canvas id="chart-demand-wait-time"></canvas>
            </div>
          </div>
          <div class="chart-grid" style="grid-template-columns: 1fr;">
            <div class="chart-container">
              <canvas id="chart-demand-hourly"></canvas>
            </div>
          </div>
          <div class="chart-grid">
            <div class="chart-container">
              <canvas id="chart-job-type"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    
    window.vehicleChartData = [{"name":"vehicle_01","totalJobs":13,"totalDistance":23.331000000000003,"idleTime":129.1,"utilizationRate":"64.1","avgDistancePerJob":"1.79"},{"name":"vehicle_02","totalJobs":15,"totalDistance":25.330000000000002,"idleTime":96.65,"utilizationRate":"73.2","avgDistancePerJob":"1.69"},{"name":"vehicle_03","totalJobs":15,"totalDistance":21.113000000000003,"idleTime":125.13333333333334,"utilizationRate":"65.2","avgDistancePerJob":"1.41"},{"name":"vehicle_04","totalJobs":15,"totalDistance":25.399,"idleTime":92.71666666666667,"utilizationRate":"74.2","avgDistancePerJob":"1.69"},{"name":"vehicle_05","totalJobs":15,"totalDistance":19.069,"idleTime":130.96666666666667,"utilizationRate":"63.6","avgDistancePerJob":"1.27"},{"name":"vehicle_06","totalJobs":15,"totalDistance":26.399999999999995,"idleTime":96.35,"utilizationRate":"73.2","avgDistancePerJob":"1.76"},{"name":"vehicle_07","totalJobs":13,"totalDistance":23.092000000000002,"idleTime":136.88333333333333,"utilizationRate":"62.0","avgDistancePerJob":"1.78"},{"name":"vehicle_08","totalJobs":19,"totalDistance":19.436,"idleTime":95.78333333333333,"utilizationRate":"73.4","avgDistancePerJob":"1.02"},{"name":"vehicle_09","totalJobs":16,"totalDistance":21.207,"idleTime":116.38333333333334,"utilizationRate":"67.7","avgDistancePerJob":"1.33"},{"name":"vehicle_10","totalJobs":13,"totalDistance":28.439,"idleTime":106.88333333333334,"utilizationRate":"70.3","avgDistancePerJob":"2.19"}];
    window.demandStats = {"summary":{"totalDemands":200,"completedDemands":149,"rejectedDemands":51,"completionRate":"74.5"},"distanceStats":[{"id":"DM0066","distance":0.208},{"id":"DM0048","distance":0.112},{"id":"DM0067","distance":1.31},{"id":"DM0157","distance":0.601},{"id":"DM0130","distance":6.615},{"id":"DM0035","distance":0.709},{"id":"DM0120","distance":0.733},{"id":"DM0176","distance":1.229},{"id":"DM0178","distance":0.162},{"id":"DM0017","distance":2.191},{"id":"DM0049","distance":2.245},{"id":"DM0144","distance":0.579},{"id":"DM0081","distance":0.708},{"id":"DM0007","distance":1.094},{"id":"DM0012","distance":2.414},{"id":"DM0177","distance":1.963},{"id":"DM0051","distance":1.402},{"id":"DM0137","distance":1.387},{"id":"DM0059","distance":1.708},{"id":"DM0041","distance":2.1},{"id":"DM0014","distance":2.24},{"id":"DM0136","distance":2.147},{"id":"DM0052","distance":1.391},{"id":"DM0026","distance":0.444},{"id":"DM0094","distance":0.954},{"id":"DM0042","distance":0.662},{"id":"DM0135","distance":3.642},{"id":"DM0086","distance":1.598},{"id":"DM0167","distance":1.326},{"id":"DM0043","distance":2.436},{"id":"DM0071","distance":1.748},{"id":"DM0080","distance":0.987},{"id":"DM0033","distance":2.428},{"id":"DM0088","distance":1.955},{"id":"DM0131","distance":1.655},{"id":"DM0060","distance":2.452},{"id":"DM0053","distance":0.719},{"id":"DM0162","distance":2.295},{"id":"DM0003","distance":2.08},{"id":"DM0085","distance":4.125},{"id":"DM0164","distance":0.533},{"id":"DM0161","distance":0.58},{"id":"DM0192","distance":0.453},{"id":"DM0153","distance":0.235},{"id":"DM0013","distance":3.139},{"id":"DM0096","distance":0.776},{"id":"DM0079","distance":2.062},{"id":"DM0107","distance":2.791},{"id":"DM0078","distance":1.019},{"id":"DM0091","distance":2.267},{"id":"DM0076","distance":0.956},{"id":"DM0104","distance":1.163},{"id":"DM0156","distance":0.766},{"id":"DM0200","distance":2.322},{"id":"DM0084","distance":1.569},{"id":"DM0151","distance":0.748},{"id":"DM0024","distance":1.817},{"id":"DM0083","distance":2.746},{"id":"DM0150","distance":1.229},{"id":"DM0038","distance":1.097},{"id":"DM0152","distance":0.717},{"id":"DM0018","distance":4.095},{"id":"DM0006","distance":0.152},{"id":"DM0138","distance":0.929},{"id":"DM0019","distance":0.194},{"id":"DM0064","distance":0.951},{"id":"DM0073","distance":0.851},{"id":"DM0106","distance":1.433},{"id":"DM0034","distance":2.247},{"id":"DM0001","distance":2.604},{"id":"DM0132","distance":0.649},{"id":"DM0101","distance":0.856},{"id":"DM0039","distance":1.143},{"id":"DM0127","distance":1.269},{"id":"DM0159","distance":1.281},{"id":"DM0098","distance":1.759},{"id":"DM0029","distance":0.677},{"id":"DM0099","distance":1.523},{"id":"DM0188","distance":0.948},{"id":"DM0010","distance":1.021},{"id":"DM0097","distance":2.169},{"id":"DM0148","distance":2.59},{"id":"DM0158","distance":0.493},{"id":"DM0184","distance":1.762},{"id":"DM0092","distance":2.638},{"id":"DM0031","distance":2.33},{"id":"DM0008","distance":1.742},{"id":"DM0030","distance":2.084},{"id":"DM0068","distance":1.119},{"id":"DM0196","distance":1.022},{"id":"DM0112","distance":0.584},{"id":"DM0179","distance":0.742},{"id":"DM0009","distance":1.238},{"id":"DM0023","distance":1.325},{"id":"DM0146","distance":0.455},{"id":"DM0065","distance":0.928},{"id":"DM0050","distance":1.391},{"id":"DM0046","distance":2.726},{"id":"DM0044","distance":1.674},{"id":"DM0133","distance":1.236},{"id":"DM0168","distance":1.188},{"id":"DM0087","distance":1.156},{"id":"DM0191","distance":0.605},{"id":"DM0022","distance":1.985},{"id":"DM0141","distance":2.136},{"id":"DM0047","distance":0.372},{"id":"DM0149","distance":1.814},{"id":"DM0185","distance":2.749},{"id":"DM0109","distance":2.116},{"id":"DM0077","distance":2.006},{"id":"DM0025","distance":2.631},{"id":"DM0172","distance":2.394},{"id":"DM0197","distance":0.83},{"id":"DM0063","distance":1.342},{"id":"DM0100","distance":1.056},{"id":"DM0056","distance":0.777},{"id":"DM0193","distance":1.345},{"id":"DM0075","distance":1.944},{"id":"DM0125","distance":1.866},{"id":"DM0108","distance":1.011},{"id":"DM0054","distance":1.167},{"id":"DM0070","distance":0.87},{"id":"DM0134","distance":1.591},{"id":"DM0061","distance":1.125},{"id":"DM0002","distance":2.119},{"id":"DM0093","distance":2.388},{"id":"DM0037","distance":1.513},{"id":"DM0181","distance":1.689},{"id":"DM0016","distance":1.852},{"id":"DM0062","distance":2.961},{"id":"DM0021","distance":1.88},{"id":"DM0171","distance":2.61},{"id":"DM0090","distance":1.716},{"id":"DM0105","distance":1.585},{"id":"DM0174","distance":4.461},{"id":"DM0190","distance":1.755},{"id":"DM0040","distance":1.432},{"id":"DM0129","distance":3.254},{"id":"DM0045","distance":0.395},{"id":"DM0187","distance":1.339},{"id":"DM0114","distance":1.773},{"id":"DM0170","distance":1.759},{"id":"DM0145","distance":1.934},{"id":"DM0189","distance":0.472},{"id":"DM0082","distance":2.841},{"id":"DM0058","distance":1.245},{"id":"DM0143","distance":2.122},{"id":"DM0032","distance":0.625},{"id":"DM0183","distance":0.451}],"waitTimeStats":[{"id":"DM0066","waitTime":0.9},{"id":"DM0048","waitTime":0.2},{"id":"DM0067","waitTime":8.316666666666666},{"id":"DM0157","waitTime":1.1333333333333333},{"id":"DM0130","waitTime":27.85},{"id":"DM0035","waitTime":4.8},{"id":"DM0120","waitTime":2.8666666666666667},{"id":"DM0176","waitTime":5.016666666666667},{"id":"DM0178","waitTime":1.05},{"id":"DM0017","waitTime":8.35},{"id":"DM0049","waitTime":7.683333333333334},{"id":"DM0144","waitTime":2.0166666666666666},{"id":"DM0081","waitTime":2.5},{"id":"DM0007","waitTime":5.383333333333334},{"id":"DM0012","waitTime":13.083333333333334},{"id":"DM0177","waitTime":6.8},{"id":"DM0051","waitTime":4.316666666666666},{"id":"DM0137","waitTime":4.633333333333334},{"id":"DM0059","waitTime":6.2},{"id":"DM0041","waitTime":9.733333333333333},{"id":"DM0014","waitTime":6.9},{"id":"DM0136","waitTime":11.9},{"id":"DM0052","waitTime":7.483333333333333},{"id":"DM0026","waitTime":0.8666666666666667},{"id":"DM0094","waitTime":3.066666666666667},{"id":"DM0042","waitTime":2.433333333333333},{"id":"DM0135","waitTime":15.7},{"id":"DM0086","waitTime":8.483333333333333},{"id":"DM0167","waitTime":4.15},{"id":"DM0043","waitTime":8.083333333333334},{"id":"DM0071","waitTime":4.716666666666667},{"id":"DM0080","waitTime":3},{"id":"DM0033","waitTime":8.55},{"id":"DM0088","waitTime":5.583333333333333},{"id":"DM0131","waitTime":7.183333333333334},{"id":"DM0060","waitTime":10.366666666666667},{"id":"DM0053","waitTime":2.6666666666666665},{"id":"DM0162","waitTime":12.633333333333333},{"id":"DM0003","waitTime":9.133333333333333},{"id":"DM0085","waitTime":12.333333333333334},{"id":"DM0164","waitTime":1.2666666666666666},{"id":"DM0161","waitTime":1.95},{"id":"DM0192","waitTime":1.6166666666666667},{"id":"DM0153","waitTime":0.26666666666666666},{"id":"DM0013","waitTime":11.283333333333333},{"id":"DM0096","waitTime":1.4666666666666666},{"id":"DM0079","waitTime":16.2},{"id":"DM0107","waitTime":10.916666666666666},{"id":"DM0078","waitTime":5.516666666666667},{"id":"DM0091","waitTime":8.316666666666666},{"id":"DM0076","waitTime":2.9833333333333334},{"id":"DM0104","waitTime":4.733333333333333},{"id":"DM0156","waitTime":1.3166666666666667},{"id":"DM0200","waitTime":10.966666666666667},{"id":"DM0084","waitTime":7.2},{"id":"DM0151","waitTime":2.95},{"id":"DM0024","waitTime":6.416666666666667},{"id":"DM0083","waitTime":16.416666666666668},{"id":"DM0150","waitTime":6.516666666666667},{"id":"DM0038","waitTime":4.316666666666666},{"id":"DM0152","waitTime":2.066666666666667},{"id":"DM0018","waitTime":12.966666666666667},{"id":"DM0006","waitTime":0.15},{"id":"DM0138","waitTime":3.5166666666666666},{"id":"DM0019","waitTime":0.3},{"id":"DM0064","waitTime":3.4833333333333334},{"id":"DM0073","waitTime":2.65},{"id":"DM0106","waitTime":6.516666666666667},{"id":"DM0034","waitTime":9.516666666666667},{"id":"DM0001","waitTime":13.916666666666666},{"id":"DM0132","waitTime":1.1333333333333333},{"id":"DM0101","waitTime":3.9833333333333334},{"id":"DM0039","waitTime":3.15},{"id":"DM0127","waitTime":4.6},{"id":"DM0159","waitTime":4.766666666666667},{"id":"DM0098","waitTime":10.883333333333333},{"id":"DM0029","waitTime":2.1166666666666667},{"id":"DM0099","waitTime":4.933333333333334},{"id":"DM0188","waitTime":6.766666666666667},{"id":"DM0010","waitTime":3.8833333333333333},{"id":"DM0097","waitTime":9.95},{"id":"DM0148","waitTime":9.233333333333333},{"id":"DM0158","waitTime":1.8166666666666667},{"id":"DM0184","waitTime":7.716666666666667},{"id":"DM0092","waitTime":12.516666666666667},{"id":"DM0031","waitTime":6.833333333333333},{"id":"DM0008","waitTime":7.1},{"id":"DM0030","waitTime":9.516666666666667},{"id":"DM0068","waitTime":5.233333333333333},{"id":"DM0196","waitTime":6.083333333333333},{"id":"DM0112","waitTime":1.7333333333333334},{"id":"DM0179","waitTime":3.0166666666666666},{"id":"DM0009","waitTime":3.6333333333333333},{"id":"DM0023","waitTime":6.2},{"id":"DM0146","waitTime":1.2},{"id":"DM0065","waitTime":6.15},{"id":"DM0050","waitTime":4.833333333333333},{"id":"DM0046","waitTime":9.066666666666666},{"id":"DM0044","waitTime":4.5},{"id":"DM0133","waitTime":4.933333333333334},{"id":"DM0168","waitTime":3.85},{"id":"DM0087","waitTime":4.466666666666667},{"id":"DM0191","waitTime":2.466666666666667},{"id":"DM0022","waitTime":6.583333333333333},{"id":"DM0141","waitTime":11.583333333333334},{"id":"DM0047","waitTime":1.3},{"id":"DM0149","waitTime":5.183333333333334},{"id":"DM0185","waitTime":13.266666666666667},{"id":"DM0109","waitTime":11.416666666666666},{"id":"DM0077","waitTime":9},{"id":"DM0025","waitTime":14.283333333333333},{"id":"DM0172","waitTime":13.833333333333334},{"id":"DM0197","waitTime":4.7},{"id":"DM0063","waitTime":8.216666666666667},{"id":"DM0100","waitTime":4.333333333333333},{"id":"DM0056","waitTime":1.45},{"id":"DM0193","waitTime":6.633333333333334},{"id":"DM0075","waitTime":8.016666666666667},{"id":"DM0125","waitTime":9.85},{"id":"DM0108","waitTime":4.983333333333333},{"id":"DM0054","waitTime":6.366666666666666},{"id":"DM0070","waitTime":3.9166666666666665},{"id":"DM0134","waitTime":6.933333333333334},{"id":"DM0061","waitTime":5.716666666666667},{"id":"DM0002","waitTime":10.866666666666667},{"id":"DM0093","waitTime":10.25},{"id":"DM0037","waitTime":7.433333333333334},{"id":"DM0181","waitTime":7.033333333333333},{"id":"DM0016","waitTime":7.95},{"id":"DM0062","waitTime":11.433333333333334},{"id":"DM0021","waitTime":6.883333333333334},{"id":"DM0171","waitTime":11.9},{"id":"DM0090","waitTime":7.216666666666667},{"id":"DM0105","waitTime":7.1},{"id":"DM0174","waitTime":20.166666666666668},{"id":"DM0190","waitTime":12.05},{"id":"DM0040","waitTime":8.433333333333334},{"id":"DM0129","waitTime":13.566666666666666},{"id":"DM0045","waitTime":0.7333333333333333},{"id":"DM0187","waitTime":5.866666666666666},{"id":"DM0114","waitTime":9.433333333333334},{"id":"DM0170","waitTime":7.983333333333333},{"id":"DM0145","waitTime":8.683333333333334},{"id":"DM0189","waitTime":2.5833333333333335},{"id":"DM0082","waitTime":9.666666666666666},{"id":"DM0058","waitTime":4.6},{"id":"DM0143","waitTime":6.233333333333333},{"id":"DM0032","waitTime":1.9833333333333334},{"id":"DM0183","waitTime":1.5}],"timeSlots":{"0":0,"10":3,"20":5,"30":5,"40":4,"50":8,"60":2,"70":7,"80":4,"90":7,"100":2,"110":6,"120":4,"130":5,"140":5,"150":6,"160":3,"170":7,"180":4,"190":7,"200":4,"210":7,"220":2,"230":6,"240":4,"250":5,"260":5,"270":6,"280":4,"290":6,"300":6,"310":0,"320":0,"330":0,"340":0,"350":0},"jobTypeStats":{"normal":{"total":195,"completed":148},"delivery":{"total":3,"completed":1},"pickup":{"total":2,"completed":0}}};
    
    
    // Tab switching
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        // Remove active class from all tabs and panes
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
        
        // Add active class to clicked tab and corresponding pane
        tab.classList.add('active');
        const tabName = tab.dataset.tab;
        document.getElementById(tabName + '-tab').classList.add('active');
      });
    });
    
    // 페이지 로드 시 차트 초기화
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOMContentLoaded - vehicleChartData:', window.vehicleChartData);
      console.log('DOMContentLoaded - demandStats:', window.demandStats);
      
      if (window.vehicleChartData && window.Chart) {
        initializeAllCharts();
      }
      if (window.demandStats && window.Chart) {
        initializeDemandCharts();
      } else {
        console.warn('demandStats or Chart not available');
      }
    });
    
    // 차트 초기화 함수
    function initializeAllCharts() {
      if (!window.vehicleChartData || window.vehicleChartData.length === 0) {
        console.error('No vehicle data available');
        return;
      }
      
      const vehicleNames = window.vehicleChartData.map(v => v.name);
      const Chart = window.Chart;
      
      // Helper function to calculate average
      function getAverage(data) {
        return data.reduce((a, b) => a + b, 0) / data.length;
      }

      // Helper function to format average label
      function formatAvgLabel(avg) {
        return 'Avg: ' + avg.toFixed(2);
      }

      // Plugin to draw average line
      const averageLinePlugin = {
        id: 'averageLine',
        afterDatasetsDraw(chart) {
          const ctx = chart.ctx;
          const yScale = chart.scales.y;
          const xScale = chart.scales.x;
          
          if (!chart.avgData) return;
          
          const avgValue = chart.avgData.value;
          const avgLabel = chart.avgData.label;
          const avgColor = 'rgb(192, 0, 0)'; // Red color
          
          const yPixel = yScale.getPixelForValue(avgValue);
          
          // Draw dashed line
          ctx.strokeStyle = avgColor;
          ctx.lineWidth = 2;
          ctx.setLineDash([5, 5]);
          ctx.beginPath();
          ctx.moveTo(xScale.left, yPixel);
          ctx.lineTo(xScale.right, yPixel);
          ctx.stroke();
          ctx.setLineDash([]);
          
          // Draw average label with white border
          ctx.font = 'bold 10px Arial';
          ctx.textAlign = 'right';
          ctx.textBaseline = 'top';
          const textX = xScale.right - 5;
          const textY = yPixel - 20; // Moved up more
          const padding = 3;
          
          // Draw white border
          ctx.strokeStyle = 'white';
          ctx.lineWidth = 1;
          ctx.strokeText(avgLabel, textX - padding, textY + padding);
          
          // Draw text with red color
          ctx.fillStyle = avgColor;
          ctx.fillText(avgLabel, textX - padding, textY + padding);
        }
      };

      // Chart 1: Jobs per Vehicle
      const ctxJobs = document.getElementById('chart-jobs');
      if (ctxJobs) {
        const jobsData = window.vehicleChartData.map(v => v.totalJobs);
        const jobsAvg = getAverage(jobsData);
        
        const chartJobs = new Chart(ctxJobs, {
          type: 'bar',
          data: {
            labels: vehicleNames,
            datasets: [{
              label: 'Jobs Completed',
              data: jobsData,
              backgroundColor: 'rgba(102, 126, 234, 0.8)',
              borderColor: 'rgba(102, 126, 234, 1)',
              borderWidth: 2
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              title: {
                display: true,
                text: 'Jobs Completed by Vehicle',
                font: { size: 11, weight: 'bold' }
              },
              legend: {
                display: false,
                labels: { font: { size: 9 } }
              }
            },
            scales: {
              x: {
                ticks: {
                  font: { size: 9 }
                }
              },
              y: {
                beginAtZero: true,
                ticks: {
                  stepSize: 1,
                  font: { size: 9 }
                }
              }
            }
          },
          plugins: [averageLinePlugin]
        });
        
        chartJobs.avgData = {
          value: jobsAvg,
          color: 'rgb(192, 0, 0)',
          label: formatAvgLabel(jobsAvg)
        };
        chartJobs.update('none');
      }
      
      // Chart 2: Distance per Vehicle
      const ctxDistance = document.getElementById('chart-distance');
      if (ctxDistance) {
        const distanceData = window.vehicleChartData.map(v => v.totalDistance);
        const distanceAvg = getAverage(distanceData);
        
        const chartDistance = new Chart(ctxDistance, {
          type: 'bar',
          data: {
            labels: vehicleNames,
            datasets: [{
              label: 'Distance (km)',
              data: distanceData,
              backgroundColor: 'rgba(240, 147, 251, 0.8)',
              borderColor: 'rgba(240, 147, 251, 1)',
              borderWidth: 2
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              title: {
                display: true,
                text: 'Total Distance Traveled by Vehicle',
                font: { size: 11, weight: 'bold' }
              },
              legend: {
                display: false,
                labels: { font: { size: 9 } }
              }
            },
            scales: {
              x: {
                ticks: {
                  font: { size: 9 }
                }
              },
              y: {
                beginAtZero: true,
                ticks: {
                  font: { size: 9 }
                }
              }
            }
          },
          plugins: [averageLinePlugin]
        });
        
        chartDistance.avgData = {
          value: distanceAvg,
          color: 'rgb(192, 0, 0)',
          label: formatAvgLabel(distanceAvg)
        };
        chartDistance.update('none');
      }
      
      // Chart 3: Idle Time per Vehicle
      const ctxIdle = document.getElementById('chart-idle');
      if (ctxIdle) {
        const idleData = window.vehicleChartData.map(v => v.idleTime);
        const idleAvg = getAverage(idleData);
        
        const chartIdle = new Chart(ctxIdle, {
          type: 'bar',
          data: {
            labels: vehicleNames,
            datasets: [{
              label: 'Idle Time (min)',
              data: idleData,
              backgroundColor: 'rgba(79, 172, 254, 0.8)',
              borderColor: 'rgba(79, 172, 254, 1)',
              borderWidth: 2
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              title: {
                display: true,
                text: 'Idle Time by Vehicle',
                font: { size: 11, weight: 'bold' }
              },
              legend: {
                display: false,
                labels: { font: { size: 9 } }
              }
            },
            scales: {
              x: {
                ticks: {
                  font: { size: 9 }
                }
              },
              y: {
                beginAtZero: true,
                ticks: {
                  font: { size: 9 }
                }
              }
            }
          },
          plugins: [averageLinePlugin]
        });
        
        chartIdle.avgData = {
          value: idleAvg,
          color: 'rgb(192, 0, 0)',
          label: formatAvgLabel(idleAvg)
        };
        chartIdle.update('none');
      }
      
      // Chart 4: Utilization Rate per Vehicle
      const ctxUtilization = document.getElementById('chart-utilization');
      if (ctxUtilization) {
        const utilizationData = window.vehicleChartData.map(v => parseFloat(v.utilizationRate));
        const utilizationAvg = getAverage(utilizationData);
        
        const chartUtilization = new Chart(ctxUtilization, {
          type: 'bar',
          data: {
            labels: vehicleNames,
            datasets: [{
              label: 'Utilization Rate (%)',
              data: utilizationData,
              backgroundColor: 'rgba(67, 233, 123, 0.8)',
              borderColor: 'rgba(67, 233, 123, 1)',
              borderWidth: 2
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              title: {
                display: true,
                text: 'Vehicle Utilization Rate',
                font: { size: 11, weight: 'bold' }
              },
              legend: {
                display: false,
                labels: { font: { size: 9 } }
              }
            },
            scales: {
              x: {
                ticks: {
                  font: { size: 9 }
                }
              },
              y: {
                beginAtZero: true,
                max: 100,
                ticks: {
                  font: { size: 9 },
                  callback: function(value) {
                    return value + '%';
                  }
                }
              }
            }
          },
          plugins: [averageLinePlugin]
        });
        
        chartUtilization.avgData = {
          value: utilizationAvg,
          color: 'rgb(192, 0, 0)',
          label: formatAvgLabel(utilizationAvg)
        };
        chartUtilization.update('none');
      }
      
      // Chart 5: Average Distance per Job
      const ctxAvgDistance = document.getElementById('chart-avg-distance');
      if (ctxAvgDistance) {
        const avgDistanceData = window.vehicleChartData.map(v => parseFloat(v.avgDistancePerJob));
        const avgDistanceAvg = getAverage(avgDistanceData);
        
        const chartAvgDistance = new Chart(ctxAvgDistance, {
          type: 'bar',
          data: {
            labels: vehicleNames,
            datasets: [{
              label: 'Avg Distance per Job (km)',
              data: avgDistanceData,
              backgroundColor: 'rgba(255, 99, 132, 0.8)',
              borderColor: 'rgba(255, 99, 132, 1)',
              borderWidth: 2
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              title: {
                display: true,
                text: 'Average Distance per Job by Vehicle',
                font: { size: 11, weight: 'bold' }
              },
              legend: {
                display: false,
                labels: { font: { size: 9 } }
              }
            },
            scales: {
              x: {
                ticks: {
                  font: { size: 9 }
                }
              },
              y: {
                beginAtZero: true,
                ticks: {
                  font: { size: 9 }
                }
              }
            }
          },
          plugins: [averageLinePlugin]
        });
        
        chartAvgDistance.avgData = {
          value: avgDistanceAvg,
          color: 'rgb(192, 0, 0)',
          label: formatAvgLabel(avgDistanceAvg)
        };
        chartAvgDistance.update('none');
      }
    }
    
    // Initialize demand charts
    function initializeDemandCharts() {
      if (!window.demandStats) {
        console.error('No demand data available');
        return;
      }
      
      const stats = window.demandStats;
      const Chart = window.Chart;
      
      console.log('Initializing demand charts with stats:', stats);
      
      // Plugin to draw average line (same as vehicle charts)
      const averageLinePlugin = {
        id: 'averageLine',
        afterDatasetsDraw(chart) {
          const ctx = chart.ctx;
          const yScale = chart.scales.y;
          const xScale = chart.scales.x;
          
          if (!chart.avgData) return;
          
          const avgValue = chart.avgData.value;
          const avgLabel = chart.avgData.label;
          const avgColor = 'rgb(192, 0, 0)'; // Red color
          
          const yPixel = yScale.getPixelForValue(avgValue);
          
          // Draw dashed line
          ctx.strokeStyle = avgColor;
          ctx.lineWidth = 2;
          ctx.setLineDash([5, 5]);
          ctx.beginPath();
          ctx.moveTo(xScale.left, yPixel);
          ctx.lineTo(xScale.right, yPixel);
          ctx.stroke();
          ctx.setLineDash([]);
          
          // Draw average label with white border
          ctx.font = 'bold 10px Arial';
          ctx.textAlign = 'right';
          ctx.textBaseline = 'top';
          const textX = xScale.right - 5;
          const textY = yPixel - 20;
          const padding = 3;
          
          // Draw white border
          ctx.strokeStyle = 'white';
          ctx.lineWidth = 1;
          ctx.strokeText(avgLabel, textX - padding, textY + padding);
          
          // Draw text with red color
          ctx.fillStyle = avgColor;
          ctx.fillText(avgLabel, textX - padding, textY + padding);
        }
      };
      
      // Update summary cards
      try {
        document.getElementById('total-demands').textContent = stats.summary.totalDemands;
        document.getElementById('completed-demands').textContent = stats.summary.completedDemands;
        document.getElementById('rejected-demands').textContent = stats.summary.rejectedDemands;
        document.getElementById('completion-rate').textContent = stats.summary.completionRate;
        console.log('Summary cards updated successfully');
      } catch (error) {
        console.error('Error updating summary cards:', error);
      }
      
      // Chart 1: Demand Distance Distribution
      const ctxDemandDistance = document.getElementById('chart-demand-distance');
      if (ctxDemandDistance && stats.distanceStats && stats.distanceStats.length > 0) {
        try {
          const sortedStats = stats.distanceStats.sort((a, b) => a.distance - b.distance);
          const distances = sortedStats.map(d => d.distance);
          const avgDistance = distances.reduce((a, b) => a + b, 0) / distances.length;
          
          const chartDistanceInstance = new Chart(ctxDemandDistance, {
            type: 'bar',
            data: {
              labels: sortedStats.map(d => d.id),
              datasets: [{
                label: 'Distance (km)',
                data: distances,
                backgroundColor: 'rgba(102, 126, 234, 0.8)',
                borderColor: 'rgba(102, 126, 234, 1)',
                borderWidth: 1
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              indexAxis: 'x',
              plugins: {
                title: {
                  display: true,
                  text: 'Distance per Demand',
                  font: { size: 11, weight: 'bold' }
                },
                legend: {
                  display: false
                },
                tooltip: {
                  callbacks: {
                    title: function(context) {
                      return 'Demand ID: ' + context[0].label;
                    },
                    label: function(context) {
                      return 'Distance: ' + context.parsed.y.toFixed(2) + ' km';
                    }
                  }
                }
              },
              scales: {
                x: {
                  ticks: {
                    font: { size: 8 },
                    maxRotation: 45
                  }
                },
                y: {
                  beginAtZero: true,
                  ticks: {
                    font: { size: 9 }
                  },
                  title: {
                    display: true,
                    text: 'Distance (km)',
                    font: { size: 9 }
                  }
                }
              }
            },
            plugins: [averageLinePlugin]
          });
          
          chartDistanceInstance.avgData = {
            value: avgDistance,
            color: 'rgb(192, 0, 0)',
            label: 'Avg: ' + avgDistance.toFixed(2)
          };
          chartDistanceInstance.update('none');
          console.log('Distance chart created');
        } catch (error) {
          console.error('Error creating distance chart:', error);
        }
      } else {
        console.warn('No distance stats available or container not found');
      }
      
      // Chart 2: Wait Time Distribution
      const ctxWaitTime = document.getElementById('chart-demand-wait-time');
      if (ctxWaitTime && stats.waitTimeStats && stats.waitTimeStats.length > 0) {
        try {
          const sortedStats = stats.waitTimeStats.sort((a, b) => a.waitTime - b.waitTime);
          const waitTimes = sortedStats.map(d => d.waitTime);
          const avgWaitTime = waitTimes.reduce((a, b) => a + b, 0) / waitTimes.length;
          
          const chartWaitTimeInstance = new Chart(ctxWaitTime, {
            type: 'bar',
            data: {
              labels: sortedStats.map(d => d.id),
              datasets: [{
                label: 'Wait Time (min)',
                data: waitTimes,
                backgroundColor: 'rgba(240, 147, 251, 0.8)',
                borderColor: 'rgba(240, 147, 251, 1)',
                borderWidth: 1
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              indexAxis: 'x',
              plugins: {
                title: {
                  display: true,
                  text: 'Wait Time per Demand',
                  font: { size: 11, weight: 'bold' }
                },
                legend: {
                  display: false
                },
                tooltip: {
                  callbacks: {
                    title: function(context) {
                      return 'Demand ID: ' + context[0].label;
                    },
                    label: function(context) {
                      return 'Wait Time: ' + context.parsed.y.toFixed(2) + ' min';
                    }
                  }
                }
              },
              scales: {
                x: {
                  ticks: {
                    font: { size: 8 },
                    maxRotation: 45
                  }
                },
                y: {
                  beginAtZero: true,
                  ticks: {
                    font: { size: 9 }
                  },
                  title: {
                    display: true,
                    text: 'Wait Time (min)',
                    font: { size: 9 }
                  }
                }
              }
            },
            plugins: [averageLinePlugin]
          });
          
          chartWaitTimeInstance.avgData = {
            value: avgWaitTime,
            color: 'rgb(192, 0, 0)',
            label: 'Avg: ' + avgWaitTime.toFixed(2)
          };
          chartWaitTimeInstance.update('none');
          console.log('Wait time chart created');
        } catch (error) {
          console.error('Error creating wait time chart:', error);
        }
      } else {
        console.warn('No wait time stats available or container not found');
      }
      
      // Chart 3: Hourly Demand Processing
      const ctxHourly = document.getElementById('chart-demand-hourly');
      if (ctxHourly && stats.timeSlots) {
        try {
          const times = Object.keys(stats.timeSlots).sort((a, b) => parseInt(a) - parseInt(b));
          const labels = times.map(t => t + ' min');
          const data = times.map(t => stats.timeSlots[t]);
          let cumulativeSum = 0;
          const cumulativeData = data.map(d => (cumulativeSum += d, cumulativeSum));
          
          new Chart(ctxHourly, {
            type: 'line',
            data: {
              labels: labels,
              datasets: [{
                label: 'Cumulative Demands Processed',
                data: cumulativeData,
                backgroundColor: 'rgba(79, 172, 254, 0.1)',
                borderColor: 'rgba(79, 172, 254, 1)',
                borderWidth: 2,
                fill: true,
                tension: 0.3,
                pointRadius: 3,
                pointBackgroundColor: 'rgba(79, 172, 254, 1)'
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                title: {
                  display: true,
                  text: 'Cumulative Demand Processing (10-min intervals)',
                  font: { size: 11, weight: 'bold' }
                },
                legend: {
                  display: false
                }
              },
              scales: {
                x: {
                  ticks: {
                    font: { size: 8 },
                    maxRotation: 45
                  }
                },
                y: {
                  beginAtZero: true,
                  ticks: {
                    font: { size: 9 }
                  }
                }
              }
            }
          });
          console.log('Hourly chart created');
        } catch (error) {
          console.error('Error creating hourly chart:', error);
        }
      } else {
        console.warn('No time slot data available or container not found');
      }
      
      // Chart 4: Job Type Statistics
      const ctxJobType = document.getElementById('chart-job-type');
      if (ctxJobType && stats.jobTypeStats) {
        try {
          const jobTypes = Object.keys(stats.jobTypeStats);
          const totalByType = jobTypes.map(type => stats.jobTypeStats[type].total);
          const completedByType = jobTypes.map(type => stats.jobTypeStats[type].completed);
          
          new Chart(ctxJobType, {
            type: 'bar',
            data: {
              labels: jobTypes,
              datasets: [
                {
                  label: 'Total Demands',
                  data: totalByType,
                  backgroundColor: 'rgba(102, 126, 234, 0.8)',
                  borderColor: 'rgba(102, 126, 234, 1)',
                  borderWidth: 2
                },
                {
                  label: 'Completed',
                  data: completedByType,
                  backgroundColor: 'rgba(67, 233, 123, 0.8)',
                  borderColor: 'rgba(67, 233, 123, 1)',
                  borderWidth: 2
                }
              ]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                title: {
                  display: true,
                  text: 'Demands by Job Type',
                  font: { size: 11, weight: 'bold' }
                },
                legend: {
                  display: true,
                  labels: { font: { size: 9 } }
                }
              },
              scales: {
                x: {
                  ticks: {
                    font: { size: 9 }
                  }
                },
                y: {
                  beginAtZero: true,
                  ticks: {
                    font: { size: 9 }
                  }
                }
              }
            }
          });
          console.log('Job type chart created');
        } catch (error) {
          console.error('Error creating job type chart:', error);
        }
      } else {
        console.warn('No job type data available or container not found');
      }
    }
  </script>
</body>
</html>
    